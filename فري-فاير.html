<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ø¨Ø§ØªÙ„ Ø±ÙˆÙŠØ§Ù„ - ÙØ±ÙŠ ÙØ§ÙŠØ± Ù…ØºØ±Ø¨ÙŠ ğŸ”¥</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(to bottom, #0f0c29, #302b63, #24243e);
      color: white;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      direction: rtl;
      text-align: center;
      overflow: hidden;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background: rgba(0,0,0,0.6);
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 0 40px rgba(255,100,0,0.5);
    }

    h1 {
      color: #ffaa00;
      text-shadow: 0 0 15px #ffaa00;
      margin-top: 0;
      font-size: 2.2rem;
    }

    canvas {
      border: 4px solid #ff4444;
      border-radius: 15px;
      background: #111;
      display: block;
      margin: 20px auto;
      box-shadow: 0 0 30px rgba(255,68,68,0.6);
      max-width: 100%;
      height: auto;
    }

    .stats {
      background: rgba(0,255,0,0.2);
      padding: 15px;
      border-radius: 10px;
      margin: 15px 0;
      font-size: 1.3rem;
    }

    .score { color: #ffd700; font-size: 1.6rem; }

    #instructions {
      font-size: 1.2rem;
      color: #00ff88;
      margin: 20px 0;
      line-height: 1.6;
    }

    button {
      padding: 18px 50px;
      margin: 15px;
      font-size: 1.3rem;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: bold;
      font-family: inherit;
    }

    #startBtn { background: #00ff88; color: black; }
    #restartBtn { background: #ffaa00; color: black; }

    button:hover:not(:disabled) {
      transform: scale(1.1);
      box-shadow: 0 0 25px currentColor;
    }

    button:disabled { opacity: 0.5; cursor: not-allowed; }

    .game-over {
      background: rgba(255,0,0,0.4);
      padding: 25px;
      border-radius: 15px;
      margin: 20px 0;
      font-size: 1.5rem;
      color: #ff6666;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Ø¨Ø§ØªÙ„ Ø±ÙˆÙŠØ§Ù„ - ÙØ±ÙŠ ÙØ§ÙŠØ± Ù…ØºØ±Ø¨ÙŠ ğŸ”¥âš”ï¸</h1>
    
    <div id="game">
      <canvas id="gameCanvas" width="700" height="500"></canvas>
      
      <div class="stats">
        <div class="score">Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score">0</span></div>
        <div>Ø§Ù„Ù…ÙˆØ¬Ø©: <span id="wave">1</span> | Ø£Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø·: <span id="highScore">0</span></div>
      </div>

      <div id="message">Ø§Ø¶ØºØ· "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©" ÙˆØ§Ø¨Ø¯Ø£ Ø§Ù„Ù‚ØªØ§Ù„! ğŸ’¥</div>
      <div id="instructions">
        ğŸ“± <strong>Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„:</strong> joystick Ø£Ø³ÙÙ„ Ø§Ù„ÙŠØ³Ø§Ø± Ù„Ù„Ø­Ø±ÙƒØ©ØŒ Ø§Ø¶ØºØ· Ø£ÙŠ Ù…ÙƒØ§Ù† Ø¢Ø®Ø± Ù„Ù„Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ù†Ø§Ø±ÙŠ!<br>
        ğŸ’» <strong>Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±:</strong> WASD Ø£Ùˆ Ø§Ù„Ø£Ø³Ù‡Ù… Ù„Ù„Ø­Ø±ÙƒØ©ØŒ Ø§Ø¶ØºØ· Ø§Ù„Ù…Ø§ÙˆØ³ Ù„Ù„Ø¥Ø·Ù„Ø§Ù‚!<br>
        Ø§Ø¬Ù…Ø¹ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø²Ø±Ù‚Ø§Ø¡ Ù„Ù„Ø´ÙØ§Ø¡ ğŸ©¹ | Ù‚ØªÙ„ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡ Ù„Ù„Ù†Ù‚Ø§Ø·!
      </div>

      <div class="controls">
        <button id="startBtn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
        <button id="restartBtn" disabled>Ø§Ù„Ø¹Ø¨ Ù…Ù† Ø¬Ø¯ÙŠØ¯</button>
      </div>
    </div>
  </div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const scoreEl = document.getElementById("score");
    const waveEl = document.getElementById("wave");
    const highScoreEl = document.getElementById("highScore");
    const messageEl = document.getElementById("message");

    const startBtn = document.getElementById("startBtn");
    const restartBtn = document.getElementById("restartBtn");

    let gameRunning = false;
    let score = 0;
    let highScore = localStorage.getItem("freeFireHighScore") || 0;
    highScoreEl.textContent = highScore;

    // Player
    const player = {
      x: 350,
      y: 250,
      size: 18,
      health: 100,
      maxHealth: 100,
      speed: 4.5,
      vx: 0,
      vy: 0,
      shootCooldown: 0,
      shake: 0
    };

    // Game objects
    let bullets = [];
    let enemies = [];
    let pickups = [];
    let particles = [];
    let spawnTimer = 0;
    let wave = 1;

    // Controls
    const keys = {};
    const joystick = {
      baseX: 90,
      baseY: 430,
      knobX: 90,
      knobY: 430,
      active: false,
      touchId: null,
      deltaX: 0,
      deltaY: 0,
      maxRadius: 55
    };

    // Events
    document.addEventListener('keydown', (e) => {
      keys[e.code] = true;
      if (e.code === 'Space') e.preventDefault();
    });
    document.addEventListener('keyup', (e) => {
      keys[e.code] = false;
    });

    canvas.addEventListener('mousedown', handleShootMouse);
    canvas.addEventListener('touchstart', handleTouchStart, { passive: false });
    canvas.addEventListener('touchmove', handleTouchMove, { passive: false });
    canvas.addEventListener('touchend', handleTouchEnd, { passive: false });
    canvas.addEventListener('touchcancel', handleTouchEnd, { passive: false });

    function handleShootMouse(e) {
      e.preventDefault();
      shoot(getMousePos(e));
    }

    function getMousePos(e) {
      const rect = canvas.getBoundingClientRect();
      return {
        x: e.clientX - rect.left,
        y: e.clientY - rect.top
      };
    }

    function handleTouchStart(e) {
      e.preventDefault();
      for (let i = 0; i < e.changedTouches.length; i++) {
        const touch = e.changedTouches[i];
        const pos = getTouchPos(touch);
        const dx = pos.x - joystick.baseX;
        const dy = pos.y - joystick.baseY;
        const dist = Math.hypot(dx, dy);
        if (dist < joystick.maxRadius + 20 && !joystick.active) {
          joystick.active = true;
          joystick.touchId = touch.identifier;
          updateJoystick(pos.x, pos.y);
          return;
        }
      }
      // Shoot
      const pos = getTouchPos(e.changedTouches[0]);
      shoot(pos);
    }

    function handleTouchMove(e) {
      e.preventDefault();
      for (let i = 0; i < e.changedTouches.length; i++) {
        const touch = e.changedTouches[i];
        if (touch.identifier === joystick.touchId) {
          updateJoystick(getTouchPos(touch).x, getTouchPos(touch).y);
          return;
        }
      }
      // Shoot on move too for hold fire
      const pos = getTouchPos(e.changedTouches[0]);
      shoot(pos);
    }

    function handleTouchEnd(e) {
      e.preventDefault();
      for (let i = 0; i < e.changedTouches.length; i++) {
        if (e.changedTouches[i].identifier === joystick.touchId) {
          joystick.active = false;
          joystick.deltaX = 0;
          joystick.deltaY = 0;
          joystick.knobX = joystick.baseX;
          joystick.knobY = joystick.baseY;
          return;
        }
      }
    }

    function getTouchPos(touch) {
      const rect = canvas.getBoundingClientRect();
      return {
        x: touch.clientX - rect.left,
        y: touch.clientY - rect.top
      };
    }

    function updateJoystick(tx, ty) {
      const dx = tx - joystick.baseX;
      const dy = ty - joystick.baseY;
      const dist = Math.hypot(dx, dy);
      if (dist <= joystick.maxRadius) {
        joystick.deltaX = dx / joystick.maxRadius;
        joystick.deltaY = dy / joystick.maxRadius;
        joystick.knobX = tx;
        joystick.knobY = ty;
      } else {
        joystick.deltaX = dx / dist;
        joystick.deltaY = dy / dist;
        joystick.knobX = joystick.baseX + (dx / dist) * joystick.maxRadius;
        joystick.knobY = joystick.baseY + (dy / dist) * joystick.maxRadius;
      }
    }

    function shoot(pos) {
      if (player.shootCooldown > 0 || !gameRunning) return;
      const dx = pos.x - player.x;
      const dy = pos.y - player.y;
      const dist = Math.hypot(dx, dy) || 1;
      const bulletSpeed = 11;
      bullets.push({
        x: player.x,
        y: player.y,
        vx: (dx / dist) * bulletSpeed,
        vy: (dy / dist) * bulletSpeed,
        size: 4
      });
      player.shootCooldown = 8; // Rapid fire
    }

    function initGame() {
      player.health = 100;
      player.x = canvas.width / 2;
      player.y = canvas.height / 2;
      player.shake = 0;
      bullets = [];
      enemies = [];
      pickups = [];
      particles = [];
      score = 0;
      wave = 1;
      spawnTimer = 0;
      scoreEl.textContent = score;
      waveEl.textContent = wave;
      messageEl.textContent = "ğŸ’¥ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù‚ØªØ§Ù„! Ø­Ø±Ùƒ ÙˆØ£Ø·Ù„Ù‚ Ø§Ù„Ù†Ø§Ø±!";
      messageEl.className = "";
      gameRunning = true;
      startBtn.disabled = true;
      restartBtn.disabled = true;
      gameLoop();
    }

    function update() {
      // Player movement
      player.vx = 0;
      player.vy = 0;
      if (keys['KeyA'] || keys['ArrowLeft']) player.vx -= player.speed;
      if (keys['KeyD'] || keys['ArrowRight']) player.vx += player.speed;
      if (keys['KeyW'] || keys['ArrowUp']) player.vy -= player.speed;
      if (keys['KeyS'] || keys['ArrowDown']) player.vy += player.speed;
      if (joystick.active) {
        player.vx += joystick.deltaX * player.speed * 1.5;
        player.vy += joystick.deltaY * player.speed * 1.5;
      }
      player.x = Math.max(player.size, Math.min(canvas.width - player.size, player.x + player.vx));
      player.y = Math.max(player.size, Math.min(canvas.height - player.size, player.y + player.vy));

      player.shootCooldown = Math.max(0, player.shootCooldown - 1);
      player.shake = Math.max(0, player.shake - 1);

      // Spawn enemies
      spawnTimer++;
      const spawnRate = Math.max(40, 120 - wave * 8);
      if (spawnTimer > spawnRate) {
        spawnEnemy();
        spawnTimer = 0;
      }

      // Update bullets
      for (let i = bullets.length - 1; i >= 0; i--) {
        const b = bullets[i];
        b.x += b.vx;
        b.y += b.vy;
        if (b.x < 0 || b.x > canvas.width || b.y < 0 || b.y > canvas.height) {
          bullets.splice(i, 1);
          continue;
        }
        // Hit enemies
        for (let j = enemies.length - 1; j >= 0; j--) {
          const e = enemies[j];
          if (Math.hypot(b.x - e.x, b.y - e.y) < e.size + b.size) {
            e.health -= 35;
            bullets.splice(i, 1);
            if (e.health <= 0) {
              createParticles(e.x, e.y);
              score += 10;
              scoreEl.textContent = score;
              wave = Math.floor(score / 50) + 1;
              waveEl.textContent = wave;
              // 25% chance pickup
              if (Math.random() < 0.25) {
                pickups.push({
                  x: e.x,
                  y: e.y,
                  size: 12,
                  amount: 30
                });
              }
            }
            break;
          }
        }
      }

      // Update enemies
      for (let i = enemies.length - 1; i >= 0; i--) {
        const e = enemies[i];
        const dx = player.x - e.x;
        const dy = player.y - e.y;
        const dist = Math.hypot(dx, dy);
        if (dist > 0) {
          const speed = e.speed + (wave * 0.15);
          e.vx = (dx / dist) * speed;
          e.vy = (dy / dist) * speed;
        }
        e.x += e.vx;
        e.y += e.vy;
        // Clamp enemies? No
        // Damage player
        if (dist < player.size + e.size) {
          player.health -= 0.8;
          player.shake = 8;
          // Push player
          player.x += (dx / dist) * 3;
          player.y += (dy / dist) * 3;
        }
      }

      // Update pickups
      for (let i = pickups.length - 1; i >= 0; i--) {
        const p = pickups[i];
        if (Math.hypot(player.x - p.x, player.y - p.y) < player.size + p.size) {
          player.health = Math.min(100, player.health + p.amount);
          pickups.splice(i, 1);
        }
      }

      // Update particles
      for (let i = particles.length - 1; i >= 0; i--) {
        const p = particles[i];
        p.x += p.vx;
        p.y += p.vy;
        p.life--;
        if (p.life <= 0) particles.splice(i, 1);
      }

      // Check game over
      if (player.health <= 0) {
        gameOver();
      }
    }

    function spawnEnemy() {
      const angle = Math.random() * Math.PI * 2;
      const dist = 350 + Math.random() * 150;
      const enemy = {
        x: canvas.width / 2 + Math.cos(angle) * dist,
        y: canvas.height / 2 + Math.sin(angle) * dist,
        vx: 0,
        vy: 0,
        health: 40 + wave * 8,
        maxHealth: 40 + wave * 8,
        speed: 1.2,
        size: 16
      };
      // Clamp to screen
      enemy.x = Math.max(enemy.size, Math.min(canvas.width - enemy.size, enemy.x));
      enemy.y = Math.max(enemy.size, Math.min(canvas.height - enemy.size, enemy.y));
      enemies.push(enemy);
    }

    function createParticles(x, y) {
      for (let i = 0; i < 12; i++) {
        particles.push({
          x: x,
          y: y,
          vx: (Math.random() - 0.5) * 8,
          vy: (Math.random() - 0.5) * 8,
          life: 25,
          size: Math.random() * 4 + 2
        });
      }
    }

    function draw() {
      // Clear
      ctx.fillStyle = '#1a3c1a';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      const shakeX = (Math.random() - 0.5) * player.shake;
      const shakeY = (Math.random() - 0.5) * player.shake;
      ctx.save();
      ctx.translate(shakeX, shakeY);

      // Player
      ctx.fillStyle = '#00ff44';
      ctx.beginPath();
      ctx.arc(player.x, player.y, player.size, 0, Math.PI * 2);
      ctx.fill();
      ctx.strokeStyle = '#00cc33';
      ctx.lineWidth = 2;
      ctx.stroke();

      // Player health bar
      ctx.fillStyle = 'red';
      ctx.fillRect(player.x - 22, player.y - player.size - 12, 44, 6);
      ctx.fillStyle = 'lime';
      ctx.fillRect(player.x - 22, player.y - player.size - 12, 44 * (player.health / 100), 6);

      // Enemies
      enemies.forEach(e => {
        ctx.fillStyle = '#ff3333';
        ctx.beginPath();
        ctx.arc(e.x, e.y, e.size, 0, Math.PI * 2);
        ctx.fill();
        ctx.strokeStyle = '#cc0000';
        ctx.lineWidth = 2;
        ctx.stroke();

        // Enemy health bar
        const barWidth = 36;
        ctx.fillStyle = 'red';
        ctx.fillRect(e.x - barWidth/2, e.y - e.size - 12, barWidth, 5);
        ctx.fillStyle = 'lime';
        ctx.fillRect(e.x - barWidth/2, e.y - e.size - 12, barWidth * (e.health / e.maxHealth), 5);
      });

      // Pickups
      pickups.forEach(p => {
        ctx.fillStyle = '#4444ff';
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
        ctx.fill();
        ctx.strokeStyle = '#6666ff';
        ctx.lineWidth = 2;
        ctx.stroke();
      });

      // Bullets
      ctx.fillStyle = '#ffff66';
      bullets.forEach(b => {
        ctx.beginPath();
        ctx.arc(b.x, b.y, b.size, 0, Math.PI * 2);
        ctx.fill();
      });

      // Particles
      particles.forEach(p => {
        ctx.save();
        ctx.globalAlpha = p.life / 25;
        ctx.fillStyle = '#ffaa00';
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
      });

      ctx.restore();

      // UI
      ctx.fillStyle = 'white';
      ctx.font = 'bold 28px Arial';
      ctx.textAlign = 'center';
      ctx.fillText(`Ø§Ù„Ù†Ù‚Ø§Ø·: ${score}`, canvas.width / 2, 35);
      ctx.fillText(`Ø§Ù„Ù…ÙˆØ¬Ø©: ${wave}`, canvas.width / 2, 70);
      ctx.fillText(`Ø§Ù„ØµØ­Ø©: ${Math.ceil(player.health)}`, canvas.width / 2, 105);

      // Joystick
      if (joystick.active) {
        ctx.save();
        ctx.translate(joystick.baseX, joystick.baseY);
        ctx.fillStyle = 'rgba(255,255,255,0.4)';
        ctx.beginPath();
        ctx.arc(0, 0, joystick.maxRadius, 0, Math.PI * 2);
        ctx.fill();
        ctx.strokeStyle = 'rgba(255,255,255,0.8)';
        ctx.lineWidth = 3;
        ctx.stroke();
        ctx.fillStyle = '#00ff88';
        ctx.beginPath();
        ctx.arc(joystick.deltaX * joystick.maxRadius, joystick.deltaY * joystick.maxRadius, 22, 0, Math.PI * 2);
        ctx.fill();
        ctx.strokeStyle = 'rgba(0,255,136,0.8)';
        ctx.lineWidth = 2;
        ctx.stroke();
        ctx.restore();
      }
    }

    function gameLoop() {
      if (gameRunning) {
        update();
        draw();
        requestAnimationFrame(gameLoop);
      }
    }

    function gameOver() {
      gameRunning = false;
      if (score > highScore) {
        highScore = score;
        highScoreEl.textContent = highScore;
        localStorage.setItem("freeFireHighScore", highScore);
        messageEl.innerHTML = `ğŸ† ÙØ²Øª Ø¨Ù€ ${score} Ù†Ù‚Ø·Ø©! Ø±Ù‚Ù… Ù‚ÙŠØ§Ø³ÙŠ Ø¬Ø¯ÙŠØ¯! ğŸ”¥`;
      } else {
        messageEl.innerHTML = `ğŸ’€ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©! Ù†Ù‚Ø§Ø·Ùƒ: ${score} | Ø§Ù„Ø£Ø¹Ù„Ù‰: ${highScore}`;
      }
      messageEl.classList.add("game-over");
      startBtn.disabled = false;
      restartBtn.disabled = false;
    }

    startBtn.addEventListener("click", initGame);
    restartBtn.addEventListener("click", initGame);

    // Resize canvas
    function resizeCanvas() {
      canvas.width = Math.min(window.innerWidth - 40, 700);
      canvas.height = Math.min(canvas.width * 0.714, 500);
      joystick.baseX = 90 * (canvas.width / 700);
      joystick.baseY = canvas.height - 70;
      joystick.maxRadius = 55 * (canvas.width / 700);
      if (gameRunning) initGame(); // Reset pos
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();
  </script>
</body>
  </html>
